<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fault Sync Configuration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        .prose {
            max-width: none;
        }

        .prose h1 {
            font-size: 2em;
            font-weight: bold;
            margin-top: 0.67em;
            margin-bottom: 0.67em;
        }

        .prose h2 {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 0.83em;
            margin-bottom: 0.83em;
        }

        .prose h3 {
            font-size: 1.17em;
            font-weight: bold;
            margin-top: 1em;
            margin-bottom: 1em;
        }

        .prose p {
            margin-top: 1em;
            margin-bottom: 1em;
        }

        .prose code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        .prose pre {
            background: #f4f4f4;
            padding: 1em;
            border-radius: 6px;
            overflow-x: auto;
        }

        .prose pre code {
            background: none;
            padding: 0;
        }

        .prose ul,
        .prose ol {
            margin-left: 2em;
            margin-top: 1em;
            margin-bottom: 1em;
        }

        .prose table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }

        .prose th,
        .prose td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .prose th {
            background-color: #f4f4f4;
            font-weight: bold;
        }

        .prose blockquote {
            border-left: 4px solid #ddd;
            padding-left: 1em;
            margin: 1em 0;
            color: #666;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen p-8">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-md mb-6 -mt-8 -mx-8 px-8 py-3">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-6">
                <h1 class="text-lg font-bold text-gray-800">Urban Voice Fault Sync Service</h1>
                <div class="flex gap-4">
                    <a href="/" class="px-4 py-2 rounded bg-blue-600 text-white font-semibold">Configuration</a>
                    <a href="/docs.html"
                        class="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300">Documentation</a>
                </div>
            </div>
        </div>
    </nav>

    <div id="app" class="max-w-6xl mx-auto">
        <header class="mb-8 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Fault Sync Configuration</h1>
                <p class="text-gray-600">Manage Digital and Analog Fault Rules</p>
            </div>
            <button @click="saveConfig" :disabled="loading"
                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow disabled:opacity-50">
                {{ loading ? 'Saving...' : 'Save Configuration' }}
            </button>
        </header>

        <p v-if="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            {{ error }}
        </p>

        <p v-if="successMsg" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
            {{ successMsg }}
        </p>

        <div v-if="config">
            <!-- Tabs -->
            <div class="flex border-b mb-4">
                <button class="px-4 py-2 font-semibold"
                    :class="activeTab === 'config' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500'"
                    @click="activeTab = 'config'">Configuration</button>
                <button class="px-4 py-2 font-semibold"
                    :class="activeTab === 'logs' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500'"
                    @click="fetchLogs(); activeTab = 'logs'">Logs</button>
                <!-- <button class="px-4 py-2 font-semibold"
                    :class="activeTab === 'docs' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500'"
                    @click="fetchDocs(); activeTab = 'docs'">Documentation</button> -->
            </div>

            <!-- CONFIGURATION TAB -->
            <div v-if="activeTab === 'config'">
                <!-- SERVICE SETTINGS -->
                <div class="bg-blue-50 p-6 rounded-lg shadow-md mb-8 border-2 border-blue-200">
                    <div @click="sections.service = !sections.service"
                        class="cursor-pointer flex justify-between items-center hover:bg-blue-100 -m-6 p-6 rounded-t-lg transition">
                        <h2 class="text-xl font-bold text-blue-700">‚öôÔ∏è Service Settings</h2>
                        <span class="text-2xl text-blue-600 font-bold">{{ sections.service ? '‚àí' : '+' }}</span>
                    </div>
                    <div v-if="sections.service" class="mt-6 space-y-4">
                        <div class="bg-white p-5 rounded-lg border border-blue-100">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" v-model="config.service.dryRun" class="w-5 h-5">
                                <span class="font-semibold text-gray-800 text-base">Dry Run Mode</span>
                            </label>
                            <p class="text-sm text-gray-600 mt-3 ml-8 leading-relaxed">When enabled, faults are detected
                                and logged but NOT inserted into the database. Use for testing.</p>
                        </div>
                    </div>
                </div>

                <!-- SYNC RULES SETTINGS -->
                <div class="bg-green-50 p-6 rounded-lg shadow-md mb-8 border-2 border-green-200">
                    <div @click="sections.syncRules = !sections.syncRules"
                        class="cursor-pointer flex justify-between items-center hover:bg-green-100 -m-6 p-6 rounded-t-lg transition">
                        <h2 class="text-xl font-bold text-green-700">üîÑ Sync Rules Settings</h2>
                        <span class="text-2xl text-green-600 font-bold">{{ sections.syncRules ? '‚àí' : '+' }}</span>
                    </div>
                    <div v-if="sections.syncRules" class="mt-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Batch Size</label>
                                <input type="number" v-model.number="config.syncRules.batchSize"
                                    class="border rounded px-3 py-2 w-full">
                                <p class="text-xs text-gray-600 mt-1">Maximum number of records to fetch from source DB
                                    per
                                    sync job</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Lookback Hours</label>
                                <input type="number" v-model.number="config.syncRules.lookbackHours"
                                    class="border rounded px-3 py-2 w-full">
                                <p class="text-xs text-gray-600 mt-1">How far back in time to scan for faults (in hours)
                                </p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Client ID</label>
                                <input type="text" v-model="config.syncRules.clientId"
                                    class="border rounded px-3 py-2 w-full">
                                <p class="text-xs text-gray-600 mt-1">Client identifier for filtering data from source
                                    database</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Deduplication Window
                                    (Hours)</label>
                                <input type="number" v-model.number="config.syncRules.deduplicationWindowHours"
                                    class="border rounded px-3 py-2 w-full">
                                <p class="text-xs text-gray-600 mt-1">Time window to check for duplicate complaints
                                    before
                                    creating new ones</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MASTER RULES SECTION (High Priority) -->
                <div class="bg-red-50 p-6 rounded-lg shadow-md mb-8 border-2 border-red-200">
                    <div @click="sections.masterRules = !sections.masterRules"
                        class="cursor-pointer flex justify-between items-center hover:bg-red-100 -m-6 p-6 rounded-t-lg transition">
                        <div>
                            <h2 class="text-xl font-bold text-red-700 flex items-center gap-2">
                                <span class="text-2xl">‚ö°</span> Master Rules (Blocking High Priority)
                            </h2>
                        </div>
                        <span class="text-2xl text-red-600 font-bold">{{ sections.masterRules ? '‚àí' : '+' }}</span>
                    </div>
                    <div v-if="sections.masterRules" class="mt-6">
                        <button @click="addMasterRule"
                            class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm font-semibold shadow-md">
                            + Add Master Rule
                        </button>
                    </div>
                    <p class="text-sm text-gray-700 mb-6 bg-white p-4 rounded-lg border border-red-100">
                        If a Master Rule condition matches an RTU for the specified duration (e.g. 24h),
                        <strong>ALL other faults for that RTU will be suppressed</strong>. Use this for Power Failures
                        or Comm Issues.
                    </p>

                    <div v-if="config.syncRules.masterRules && config.syncRules.masterRules.length > 0"
                        class="space-y-4">
                        <div v-for="(rule, index) in config.syncRules.masterRules" :key="index"
                            class="bg-white border-l-4 border-red-500 shadow-md rounded-r-lg p-4 relative">
                            <button @click="removeMasterRule(index)"
                                class="absolute top-2 right-2 text-gray-400 hover:text-red-500 font-bold text-xl">
                                &times;
                            </button>

                            <div class="grid grid-cols-1 md:grid-cols-7 gap-4 items-end mb-4">
                                <div class="col-span-1">
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tag Name</label>
                                    <input v-model="rule.tag" class="w-full border rounded px-2 py-1 text-sm font-bold"
                                        placeholder="Tag8">
                                </div>
                                <div class="col-span-1">
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Table
                                        Source</label>
                                    <select v-model="rule.table"
                                        class="w-full border rounded px-2 py-1 text-sm bg-white">
                                        <option value="">Any</option>
                                        <option value="ANALOGUEDATA">ANALOGUEDATA</option>
                                        <option value="DIGITALDATA">DIGITALDATA</option>
                                    </select>
                                </div>
                                <div class="col-span-1">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase mb-1">Condition</label>
                                    <select v-model="rule.condition"
                                        class="w-full border rounded px-2 py-1 text-sm bg-white">
                                        <option value="equals">==</option>
                                        <option value="gt">&gt;</option>
                                        <option value="lt">&lt;</option>
                                        <option value="neq">!=</option>
                                    </select>
                                </div>
                                <div class="col-span-1">
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Trigger
                                        Value</label>
                                    <input v-model="rule.value" class="w-full border rounded px-2 py-1 text-sm"
                                        placeholder="0">
                                </div>
                                <div class="col-span-1">
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Threshold
                                        (%)</label>
                                    <input type="number" v-model.number="rule.thresholdPercent"
                                        class="w-full border rounded px-2 py-1 text-sm" placeholder="80">
                                </div>
                                <div class="col-span-1">
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Priority</label>
                                    <input type="number" v-model.number="rule.priority"
                                        class="w-full border rounded px-2 py-1 text-sm bg-red-50 font-bold text-red-700"
                                        placeholder="1">
                                    <p class="text-[9px] text-gray-400 mt-1">1 = Blocks Others</p>
                                </div>
                                <div class="col-span-1">
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Status</label>
                                    <div class="flex items-center mt-2">
                                        <input type="checkbox" v-model="rule.enabled" class="mr-2">
                                        <span class="text-xs">{{ rule.enabled ? 'Enabled' : 'Disabled' }}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Duration Section -->
                            <div class="bg-blue-50 p-2 rounded mb-4 border border-blue-100">
                                <div class="flex items-center justify-between cursor-pointer"
                                    @click="rule.showDur = !rule.showDur">
                                    <label class="block text-xs font-bold text-blue-700 uppercase">‚åõ Duration Check
                                        (Optional)</label>
                                    <span class="text-xs text-blue-500">{{ rule.duration ? 'Active' : 'None' }}</span>
                                </div>
                                <div v-if="rule.showDur || rule.duration" class="mt-2 grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-[10px] uppercase text-gray-400 font-bold">Duration</label>
                                        <input v-model="getDuration(rule).value"
                                            class="w-full border-2 border-yellow-200 bg-yellow-50 rounded px-2 py-1 text-sm font-bold text-gray-700"
                                            placeholder="24h">
                                    </div>
                                    <div>
                                        <label class="text-[10px] uppercase text-gray-400 font-bold">Mode</label>
                                        <select v-model="getDuration(rule).mode"
                                            class="w-full border rounded px-2 py-1 text-sm bg-white">
                                            <option value="continuous">Continuous</option>
                                            <option value="instant">Instant</option>
                                        </select>
                                    </div>
                                </div>
                                <div v-if="rule.duration" class="mt-1 text-right">
                                    <button @click="removeDuration(rule)"
                                        class="text-[10px] text-red-500 hover:underline">Remove Duration Check</button>
                                </div>
                                <div v-if="!rule.duration && rule.showDur" class="mt-1 text-right">
                                    <button @click="addDuration(rule)"
                                        class="text-[10px] text-green-600 hover:underline font-bold">Add This
                                        Check</button>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Alarm
                                        Type</label>
                                    <input v-model="rule.alarmType" class="w-full border rounded px-2 py-1 text-sm"
                                        placeholder="CRITICAL">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Complaint
                                        Type</label>
                                    <input v-model="rule.complaintType" class="w-full border rounded px-2 py-1 text-sm"
                                        placeholder="CMS Complaint Name">
                                </div>
                                <div class="col-span-2">
                                    <label
                                        class="block text-xs font-bold text-gray-500 uppercase mb-1">Description</label>
                                    <input v-model="rule.description" class="w-full border rounded px-2 py-1 text-sm"
                                        placeholder="Power Failure">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else>
                        <p class="text-gray-500 italic text-center py-4">No Master Rules configured.</p>
                    </div>

                    <div class="bg-white p-6 rounded shadow mb-6">
                        <h2 class="text-xl font-bold mb-4">Global Settings</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold mb-1">Lookback Hours</label>
                                <input v-model.number="config.syncRules.lookbackHours" type="number"
                                    class="w-full border rounded px-2 py-1">
                            </div>
                        </div>
                    </div>

                    <!-- Rules Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-2">
                        <!-- DI Rules Section -->
                        <section v-if="config.syncRules.ruleSets && config.syncRules.ruleSets.diRules"
                            class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center mb-4 pb-4 border-b">
                                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                    <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                                    Digital Input Rules (DI)
                                </h2>
                                <label v-if="config.syncRules.ruleSets.diRules"
                                    class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="config.syncRules.ruleSets.diRules.enabled"
                                        class="sr-only peer">
                                    <div
                                        class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                    </div>
                                    <span class="ml-3 text-sm font-medium text-gray-900">Enabled</span>
                                </label>
                            </div>

                            <div class="space-y-4">
                                <div v-for="(rule, index) in config.syncRules.ruleSets.diRules.rules" :key="index"
                                    class="border rounded-lg p-4 bg-gray-50 hover:bg-gray-100 transition">
                                    <div class="flex justify-between mb-2">
                                        <input v-model="rule.tag" class="font-bold w-1/3 border rounded px-1"
                                            placeholder="Tag Name">
                                        <select v-model="rule.condition" class="border rounded px-1 text-sm">
                                            <option value="equals">==</option>
                                            <option value="gt">&gt;</option>
                                            <option value="lt">&lt;</option>
                                            <option value="neq">!=</option>
                                        </select>
                                        <button @click="removeRule('diRules', index)"
                                            class="text-red-500 text-sm">Remove</button>
                                    </div>

                                    <div class="grid grid-cols-3 gap-4 mb-2">
                                        <div>
                                            <label class="block text-xs font-bold text-gray-700 uppercase">Trigger
                                                Value</label>
                                            <input v-model="rule.value" class="w-full border rounded px-2 py-1 text-sm">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-gray-700 uppercase">Threshold
                                                (%)</label>
                                            <input type="number" v-model.number="rule.thresholdPercent"
                                                class="w-full border rounded px-2 py-1 text-sm" placeholder="80">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-gray-700 uppercase">Alarm
                                                Type</label>
                                            <input v-model="rule.alarmType"
                                                class="w-full border rounded px-2 py-1 text-sm" placeholder="CRITICAL">
                                        </div>
                                    </div>

                                    <div class="mb-2">
                                        <label
                                            class="block text-xs font-bold text-gray-700 uppercase">Description</label>
                                        <input v-model="rule.description"
                                            class="w-full border rounded px-2 py-1 text-sm">
                                    </div>
                                    <div class="mb-2">
                                        <label class="block text-xs font-bold text-gray-700 uppercase">Complaint Type
                                            (CMS
                                            Name)</label>
                                        <input v-model="rule.complaintType"
                                            class="w-full border rounded px-2 py-1 text-sm"
                                            placeholder="e.g. Street Light Fault">
                                    </div>

                                    <!-- Prerequisite Section -->
                                    <div class="bg-gray-100 p-2 rounded mb-2">
                                        <div class="flex items-center justify-between cursor-pointer"
                                            @click="rule.showPre = !rule.showPre">
                                            <label class="block text-xs font-bold text-gray-600 uppercase">‚ö†Ô∏è
                                                Prerequisite
                                                (Optional)</label>
                                            <span class="text-xs text-blue-500">{{ rule.prerequisite ? 'Active' : 'None'
                                                }}</span>
                                        </div>

                                        <div v-if="rule.showPre || rule.prerequisite"
                                            class="mt-2 grid grid-cols-4 gap-2">
                                            <div>
                                                <input v-model="getPrerequisite(rule).tag"
                                                    class="w-full border rounded px-2 py-1 text-xs"
                                                    placeholder="Dep. Tag">
                                            </div>
                                            <div>
                                                <select v-model="getPrerequisite(rule).table"
                                                    class="w-full border rounded px-2 py-1 text-xs bg-white">
                                                    <option value="">(Same Table)</option>
                                                    <option value="DIGITALDATA">Digital</option>
                                                    <option value="ANALOGUEDATA">Analog</option>
                                                </select>
                                            </div>
                                            <div>
                                                <select v-model="getPrerequisite(rule).condition"
                                                    class="w-full border rounded px-2 py-1 text-xs bg-white">
                                                    <option value="equals">==</option>
                                                    <option value="neq">!=</option>
                                                    <option value="gt">&gt;</option>
                                                    <option value="lt">&lt;</option>
                                                </select>
                                            </div>
                                            <div>
                                                <input v-model="getPrerequisite(rule).value"
                                                    class="w-full border rounded px-2 py-1 text-xs" placeholder="Value">
                                            </div>
                                        </div>
                                        <div v-if="rule.prerequisite" class="mt-1 text-right">
                                            <button @click="delete rule.prerequisite"
                                                class="text-xs text-red-500 hover:underline">Remove Prereq</button>
                                        </div>
                                    </div>

                                    <!-- Duration Section -->
                                    <div class="bg-blue-50 p-2 rounded mb-2 border border-blue-100">
                                        <div class="flex items-center justify-between cursor-pointer"
                                            @click="rule.showDur = !rule.showDur">
                                            <label class="block text-xs font-bold text-blue-700 uppercase">‚åõ Duration
                                                Check (Optional)</label>
                                            <span class="text-xs text-blue-500">{{ rule.duration ? 'Active' : 'None'
                                                }}</span>
                                        </div>

                                        <div v-if="rule.showDur || rule.duration" class="mt-2 grid grid-cols-2 gap-2">
                                            <div>
                                                <label
                                                    class="text-[10px] uppercase text-gray-400 font-bold">Duration</label>
                                                <input v-model="getDuration(rule).value" placeholder="e.g 5m"
                                                    class="w-full border rounded px-2 py-1 text-sm bg-white">
                                            </div>
                                            <div>
                                                <label
                                                    class="text-[10px] uppercase text-gray-400 font-bold">Mode</label>
                                                <select v-model="getDuration(rule).mode"
                                                    class="w-full border rounded px-2 py-1 text-sm bg-white">
                                                    <option value="continuous">Continuous</option>
                                                    <option value="instant">Instant</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div v-if="rule.duration" class="mt-1 text-right">
                                            <button @click="removeDuration(rule)"
                                                class="text-[10px] text-red-500 hover:underline">Remove
                                                Duration</button>
                                        </div>
                                        <div v-if="!rule.duration && rule.showDur" class="mt-1 text-right">
                                            <button @click="addDuration(rule)"
                                                class="text-[10px] text-green-600 hover:underline font-bold">Add This
                                                Check</button>
                                        </div>
                                    </div>

                                    <div class="flex justify-between items-center mt-2 pt-2 border-t">
                                        <label class="inline-flex items-center cursor-pointer">
                                            <input type="checkbox" v-model="rule.enabled" class="sr-only peer">
                                            <span class="text-sm text-gray-600 mr-2">{{ rule.enabled ? 'Enabled' :
                                                'Disabled' }}</span>
                                            <div
                                                class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-600">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <button @click="addRule('diRules')"
                                    class="w-full bg-blue-50 text-blue-600 py-2 rounded border border-blue-200 hover:bg-blue-100">+
                                    Add DI Rule</button>
                            </div>
                        </section>

                        <!-- AI Rules Section -->
                        <section v-if="config.syncRules.ruleSets && config.syncRules.ruleSets.aiRules"
                            class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex justify-between items-center mb-4 pb-4 border-b">
                                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                    <span class="w-3 h-3 rounded-full bg-purple-500"></span>
                                    Analog Input Rules (AI)
                                </h2>
                                <label v-if="config.syncRules.ruleSets.aiRules"
                                    class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" v-model="config.syncRules.ruleSets.aiRules.enabled"
                                        class="sr-only peer">
                                    <div
                                        class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600">
                                    </div>
                                    <span class="ml-3 text-sm font-medium text-gray-900">Enabled</span>
                                </label>
                            </div>

                            <div class="space-y-4">
                                <div v-for="(rule, index) in config.syncRules.ruleSets.aiRules.rules" :key="index"
                                    class="border rounded-lg p-4 bg-gray-50 hover:bg-gray-100 transition">
                                    <div class="flex justify-between mb-2">
                                        <input v-model="rule.tag" class="font-bold w-1/3 border rounded px-1"
                                            placeholder="Tag Name">
                                        <select v-model="rule.condition" class="border rounded px-1 text-sm">
                                            <option value="equals">==</option>
                                            <option value="gt">&gt;</option>
                                            <option value="lt">&lt;</option>
                                            <option value="neq">!=</option>
                                        </select>
                                        <button @click="removeRule('aiRules', index)"
                                            class="text-red-500 text-sm">Remove</button>
                                    </div>
                                    <div class="grid grid-cols-3 gap-4 mb-2">
                                        <div>
                                            <label class="block text-xs font-bold text-gray-700 uppercase">Trigger
                                                Value</label>
                                            <input v-model="rule.value" class="w-full border rounded px-2 py-1 text-sm">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-gray-700 uppercase">Threshold
                                                (%)</label>
                                            <input type="number" v-model.number="rule.thresholdPercent"
                                                class="w-full border rounded px-2 py-1 text-sm" placeholder="80">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-gray-700 uppercase">Alarm
                                                Type</label>
                                            <input v-model="rule.alarmType"
                                                class="w-full border rounded px-2 py-1 text-sm" placeholder="MAJOR">
                                        </div>
                                    </div>
                                    <div class="mb-2">
                                        <label
                                            class="block text-xs font-bold text-gray-700 uppercase">Description</label>
                                        <input v-model="rule.description"
                                            class="w-full border rounded px-2 py-1 text-sm">
                                    </div>
                                    <div class="mb-2">
                                        <label class="block text-xs font-bold text-gray-700 uppercase">Complaint Type
                                            (CMS
                                            Name)</label>
                                        <input v-model="rule.complaintType"
                                            class="w-full border rounded px-2 py-1 text-sm"
                                            placeholder="e.g. Street Light Fault">
                                    </div>

                                    <!-- Prerequisite Section (AI) -->
                                    <div class="bg-gray-100 p-2 rounded mb-2">
                                        <div class="flex items-center justify-between cursor-pointer"
                                            @click="rule.showPre = !rule.showPre">
                                            <label class="block text-xs font-bold text-gray-600 uppercase">‚ö†Ô∏è
                                                Prerequisite
                                                (Optional)</label>
                                            <span class="text-xs text-blue-500">{{ rule.prerequisite ? 'Active' : 'None'
                                                }}</span>
                                        </div>

                                        <div v-if="rule.showPre || rule.prerequisite"
                                            class="mt-2 grid grid-cols-4 gap-2">
                                            <div>
                                                <input v-model="getPrerequisite(rule).tag"
                                                    class="w-full border rounded px-2 py-1 text-xs"
                                                    placeholder="Dep. Tag">
                                            </div>
                                            <div>
                                                <select v-model="getPrerequisite(rule).table"
                                                    class="w-full border rounded px-2 py-1 text-xs bg-white">
                                                    <option value="">(Same Table)</option>
                                                    <option value="DIGITALDATA">Digital</option>
                                                    <option value="ANALOGDATA">Analog</option>
                                                </select>
                                            </div>
                                            <div>
                                                <select v-model="getPrerequisite(rule).condition"
                                                    class="w-full border rounded px-2 py-1 text-xs bg-white">
                                                    <option value="equals">==</option>
                                                    <option value="neq">!=</option>
                                                    <option value="gt">&gt;</option>
                                                    <option value="lt">&lt;</option>
                                                </select>
                                            </div>
                                            <div>
                                                <input v-model="getPrerequisite(rule).value"
                                                    class="w-full border rounded px-2 py-1 text-xs" placeholder="Value">
                                            </div>
                                        </div>
                                        <div v-if="rule.prerequisite" class="mt-1 text-right">
                                            <button @click="delete rule.prerequisite"
                                                class="text-xs text-red-500 hover:underline">Remove Prereq</button>
                                        </div>
                                    </div>

                                    <!-- Duration Section -->
                                    <div class="bg-blue-50 p-2 rounded mb-2 border border-blue-100">
                                        <div class="flex items-center justify-between cursor-pointer"
                                            @click="rule.showDur = !rule.showDur">
                                            <label class="block text-xs font-bold text-blue-700 uppercase">‚åõ Duration
                                                Check (Optional)</label>
                                            <span class="text-xs text-blue-500">{{ rule.duration ? 'Active' : 'None'
                                                }}</span>
                                        </div>

                                        <div v-if="rule.showDur || rule.duration" class="mt-2 grid grid-cols-2 gap-2">
                                            <div>
                                                <label
                                                    class="text-[10px] uppercase text-gray-400 font-bold">Duration</label>
                                                <input v-model="getDuration(rule).value" placeholder="e.g 5m"
                                                    class="w-full border rounded px-2 py-1 text-sm bg-white">
                                            </div>
                                            <div>
                                                <label
                                                    class="text-[10px] uppercase text-gray-400 font-bold">Mode</label>
                                                <select v-model="getDuration(rule).mode"
                                                    class="w-full border rounded px-2 py-1 text-sm bg-white">
                                                    <option value="continuous">Continuous</option>
                                                    <option value="instant">Instant</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div v-if="rule.duration" class="mt-1 text-right">
                                            <button @click="removeDuration(rule)"
                                                class="text-[10px] text-red-500 hover:underline">Remove
                                                Duration</button>
                                        </div>
                                        <div v-if="!rule.duration && rule.showDur" class="mt-1 text-right">
                                            <button @click="addDuration(rule)"
                                                class="text-[10px] text-green-600 hover:underline font-bold">Add This
                                                Check</button>
                                        </div>
                                    </div>

                                    <div class="flex justify-between items-center mt-2 pt-2 border-t">
                                        <label class="inline-flex items-center cursor-pointer">
                                            <input type="checkbox" v-model="rule.enabled" class="sr-only peer">
                                            <span class="text-sm text-gray-600 mr-2">{{ rule.enabled ? 'Enabled' :
                                                'Disabled' }}</span>
                                            <div
                                                class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-600">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <button @click="addRule('aiRules')"
                                    class="w-full bg-blue-50 text-blue-600 py-2 rounded border border-blue-200 hover:bg-blue-100">+
                                    Add AI Rule</button>
                            </div>
                        </section>
                    </div>

                    <!-- CMS MAPPING SETTINGS -->
                    <div class="bg-purple-50 p-6 rounded-lg shadow-md mb-8 border-2 border-purple-200">
                        <div @click="sections.cmsMapping = !sections.cmsMapping"
                            class="cursor-pointer flex justify-between items-center hover:bg-purple-100 -m-6 p-6 rounded-t-lg transition">
                            <h2 class="text-xl font-bold text-purple-700">üîó CMS Mapping Settings</h2>
                            <span class="text-2xl text-purple-600 font-bold">{{ sections.cmsMapping ? '‚àí' : '+'
                                }}</span>
                        </div>
                        <div v-if="sections.cmsMapping" class="mt-6">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Default
                                        Priority</label>
                                    <select v-model="config.cmsMapping.defaultPriority"
                                        class="border rounded px-3 py-2 w-full">
                                        <option value="HIGH">HIGH</option>
                                        <option value="MEDIUM">MEDIUM</option>
                                        <option value="LOW">LOW</option>
                                    </select>
                                    <p class="text-xs text-gray-600 mt-1">Default priority level for created complaints
                                    </p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Default Status</label>
                                    <select v-model="config.cmsMapping.defaultStatus"
                                        class="border rounded px-3 py-2 w-full">
                                        <option value="REGISTERED">REGISTERED</option>
                                        <option value="PENDING">PENDING</option>
                                        <option value="IN_PROGRESS">IN_PROGRESS</option>
                                    </select>
                                    <p class="text-xs text-gray-600 mt-1">Initial status for new complaints</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Title Template</label>
                                    <input type="text" v-model="config.cmsMapping.titleTemplate"
                                        class="border rounded px-3 py-2 w-full">
                                    <p class="text-xs text-gray-600 mt-1">Template for complaint title. Use
                                        {{Description}},
                                        {{TagNumber}}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Description
                                        Template</label>
                                    <textarea v-model="config.cmsMapping.descriptionTemplate" rows="2"
                                        class="border rounded px-3 py-2 w-full"></textarea>
                                    <p class="text-xs text-gray-600 mt-1">Template for complaint description. Use
                                        {{TagNumber}}, {{AlarmType}}, {{Value}}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Submitted By
                                        ID</label>
                                    <input type="text" v-model="config.cmsMapping.defaults.submittedById"
                                        class="border rounded px-3 py-2 w-full">
                                    <p class="text-xs text-gray-600 mt-1">User ID who will be marked as submitter for
                                        auto-generated complaints</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Ward ID
                                        (Optional)</label>
                                    <input type="text" v-model="config.cmsMapping.defaults.wardId"
                                        class="border rounded px-3 py-2 w-full" placeholder="null">
                                    <p class="text-xs text-gray-600 mt-1">Default ward ID for complaints (leave empty
                                        for
                                        null)</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ERROR HANDLING SETTINGS -->
                    <div class="bg-orange-50 p-6 rounded-lg shadow-md mb-8 border-2 border-orange-200">
                        <div @click="sections.errorHandling = !sections.errorHandling"
                            class="cursor-pointer flex justify-between items-center hover:bg-orange-100 -m-6 p-6 rounded-t-lg transition">
                            <h2 class="text-xl font-bold text-orange-700">‚ö†Ô∏è Error Handling Settings</h2>
                            <span class="text-2xl text-orange-600 font-bold">{{ sections.errorHandling ? '‚àí' : '+'
                                }}</span>
                        </div>
                        <div v-if="sections.errorHandling" class="mt-6">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Retry Count</label>
                                    <input type="number" v-model.number="config.errorHandling.retryCount"
                                        class="border rounded px-3 py-2 w-full">
                                    <p class="text-xs text-gray-600 mt-1">Number of times to retry failed operations
                                        before
                                        giving up</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Retry Delay
                                        (ms)</label>
                                    <input type="number" v-model.number="config.errorHandling.retryDelayMs"
                                        class="border rounded px-3 py-2 w-full">
                                    <p class="text-xs text-gray-600 mt-1">Milliseconds to wait between retry attempts
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 flex justify-end">
                            <button @click="saveConfig"
                                class="bg-green-600 text-white px-6 py-2 rounded shadow hover:bg-green-700 font-bold">
                                Save Configuration
                            </button>
                        </div>
                    </div>
                </div>
            </div> <!-- End Config Tab -->

            <!-- LOGS TAB -->
            <div v-if="activeTab === 'logs'" class="bg-white p-6 rounded shadow">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">
                        System Logs (Payloads)
                        <span v-if="logs.length > 0" class="text-sm font-normal text-gray-500 ml-2">
                            (Showing {{ filteredLogs.length }} of {{ logs.length }})
                        </span>
                    </h2>
                    <div class="flex gap-2">
                        <select v-model="selectedLogFile" @change="fetchLogs" class="border rounded px-2 py-1">
                            <option v-for="file in logFiles" :value="file">{{ file }}</option>
                        </select>
                        <button @click="fetchLogs" class="text-blue-600 hover:underline">Refresh</button>
                    </div>
                </div>

                <!-- STATS DASHBOARD -->
                <div v-if="lastSyncStats.timestamp" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-red-50 p-4 rounded border border-red-200">
                        <h3 class="text-xs font-bold text-red-500 uppercase">Total Faults</h3>
                        <p class="text-2xl font-bold text-red-700">{{ lastSyncStats.faults }}</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded border border-yellow-200">
                        <h3 class="text-xs font-bold text-yellow-600 uppercase">Skipped</h3>
                        <p class="text-2xl font-bold text-yellow-700">{{ lastSyncStats.skipped }}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded border border-gray-200">
                        <h3 class="text-xs font-bold text-gray-500 uppercase">Errors</h3>
                        <p class="text-2xl font-bold text-gray-700">{{ lastSyncStats.errors }}</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded border border-blue-200 overflow-y-auto max-h-24">
                        <h3 class="text-xs font-bold text-blue-500 uppercase">Recent Breakdown</h3>
                        <ul class="text-xs text-blue-800 mt-1 space-y-1">
                            <li v-for="(count, type) in lastSyncStats.breakdown" :key="type"
                                class="flex justify-between">
                                <span>{{ type }}</span>
                                <span class="font-bold">{{ count }}</span>
                            </li>
                            <li v-if="Object.keys(lastSyncStats.breakdown).length === 0" class="text-gray-400 italic">No
                                faults recorded</li>
                        </ul>
                    </div>
                </div>

                <!-- Filters -->
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <input v-model="logFilter" placeholder="Search Payloads..." class="border rounded px-3 py-2 w-full">
                </div>

                <!-- Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm border-collapse">
                        <thead>
                            <tr class="bg-gray-100 text-left border-b">
                                <th class="p-3">Time</th>
                                <th class="p-3">Table</th>
                                <th class="p-3">RTU</th>
                                <th class="p-3">Tag</th>
                                <th class="p-3">Type</th>
                                <th class="p-3">Value</th>
                                <th class="p-3">Rate (%)</th>
                                <th class="p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template v-for="(log, idx) in filteredLogs" :key="idx">
                                <tr class="border-b hover:bg-gray-50" :class="{'bg-red-50': log.type === 'CRITICAL'}">
                                    <td class="p-3 whitespace-nowrap">{{ new
                                        Date(log.timestamp).toLocaleString() }}
                                    </td>
                                    <td class="p-3 text-gray-600 font-mono">{{ log.table }}</td>
                                    <td class="p-3 font-bold">{{ log.rtu }}</td>
                                    <td class="p-3 font-mono text-blue-600">{{ log.tag }}</td>
                                    <td class="p-3">
                                        <span
                                            :class="{'bg-red-100 text-red-800': log.type === 'CRITICAL', 'bg-yellow-100 text-yellow-800': log.type === 'MAJOR', 'bg-blue-100 text-blue-800': !['CRITICAL','MAJOR'].includes(log.type)}"
                                            class="px-2 py-1 rounded text-xs font-bold">
                                            {{ log.type }}
                                        </span>
                                    </td>
                                    <td class="p-3 font-mono">{{ log.value }}</td>
                                    <td class="p-3 font-mono text-center">
                                        <span v-if="log.faultPercent !== null"
                                            class="bg-gray-100 px-2 py-0.5 rounded text-xs font-bold text-gray-700">
                                            {{ log.faultPercent }}%
                                        </span>
                                        <span v-else class="text-gray-300">-</span>
                                    </td>
                                    <td class="p-3">
                                        <button @click="toggleLog(log)" class="text-blue-500 hover:underline text-xs">
                                            {{ log.expanded ? 'Hide JSON' : 'View JSON' }}
                                        </button>
                                    </td>
                                </tr>
                                <tr v-if="log.expanded">
                                    <td colspan="8"
                                        class="bg-gray-800 text-green-400 font-mono text-xs p-4 overflow-auto">
                                        <pre>{{ JSON.stringify(log.raw, null, 2) }}</pre>
                                    </td>
                                </tr>
                            </template>
                            <tr v-if="filteredLogs.length === 0">
                                <td colspan="8" class="p-4 text-center text-gray-500">No logs found
                                    matching filter.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- DOCS TAB -->
            <div v-if="activeTab === 'docs'" class="flex gap-6 h-[80vh]">
                <!-- Sidebar: File List -->
                <div class="w-64 bg-white rounded shadow p-4 overflow-y-auto">
                    <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">Documents</h3>
                </div>

                <!-- Main View: Content -->
                <div class="flex-1 bg-white rounded shadow p-8 overflow-y-auto">
                    <div v-if="loadingDoc" class="text-center text-gray-500 py-10">Loading...</div>
                    <div v-else-if="!renderedDoc" class="text-center text-gray-400 py-10">Select a document to
                        view
                    </div>
                    <div v-else class="prose max-w-none" v-html="renderedDoc"></div>
                </div>
            </div>
        </div>
    </div> <!-- End #app -->
    <script>

        const { createApp } = Vue;


        createApp({
            data() {
                return {
                    config: null,
                    loading: false,
                    error: null,
                    successMsg: null,
                    activeTab: 'config',
                    logFiles: [],
                    selectedLogFile: '',
                    logs: [],
                    lastSyncStats: { faults: 0, skipped: 0, errors: 0, breakdown: {}, timestamp: null },
                    logFilter: '',
                    // Docs
                    docFiles: [],
                    currentDoc: null,
                    renderedDoc: '',
                    loadingDoc: false,
                    // Collapsible sections
                    sections: {
                        service: true,
                        syncRules: true,
                        masterRules: true,
                        diRules: true,
                        aiRules: true,
                        cmsMapping: false,
                        errorHandling: false
                    }
                }
            },
            computed: {
                normalizedLogs() {
                    return this.logs.map((log, i) => {
                        // API now returns simplified structure: { timestamp, table, rtu, tag, type, value, raw }
                        // We just map it for display. 
                        return {
                            _index: i,
                            timestamp: log.timestamp,
                            raw: log.raw || log,
                            expanded: log.expanded,
                            table: log.table || '-',
                            rtu: log.rtu || '-',
                            tag: log.tag || '-',
                            type: log.type || '-',
                            value: log.value || '-',
                            faultPercent: log.faultPercent || null
                        };
                    });
                },
                filteredLogs() {
                    const search = (this.logFilter || '').toLowerCase();
                    return this.normalizedLogs.filter(l =>
                        !search ||
                        (l.rtu + '').toLowerCase().includes(search) ||
                        (l.tag + '').toLowerCase().includes(search) ||
                        (l.type + '').toLowerCase().includes(search) ||
                        (l.table + '').toLowerCase().includes(search)
                    );
                }
            },
            async mounted() {
                await this.fetchConfig();
                // Fetch log files list on mount
                try {
                    const res = await fetch('/api/logs/files');
                    const data = await res.json();
                    this.logFiles = data.files || [];
                    if (this.logFiles.length > 0) {
                        this.selectedLogFile = this.logFiles[0];
                        // Auto-fetch logs for the first file
                        await this.fetchLogs();
                    }
                } catch (e) {
                    console.error('Failed to fetch log files', e);
                }
            },
            methods: {
                async fetchConfig() {
                    const res = await fetch('/api/config');
                    this.config = await res.json();
                    if (!this.config.syncRules) this.config.syncRules = {};
                    if (!this.config.syncRules.ruleSets) this.config.syncRules.ruleSets = {};
                    if (!this.config.syncRules.masterRules) this.config.syncRules.masterRules = [];
                },
                async fetchLogs() {
                    let url = '/api/logs';
                    if (this.selectedLogFile) url += `?file=${this.selectedLogFile}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    this.logFiles = data.files;
                    this.selectedLogFile = data.currentFile;
                    this.logs = data.logs.map(l => ({ ...l, expanded: false }));

                    // Parse Stats
                    const summaryLog = this.logs.find(l => l.message && l.message.includes('Sync Job Completed. Faults:'));
                    if (summaryLog) {
                        const match = summaryLog.message.match(/Faults: (\d+).*?Skipped: (\d+).*?Errors: (\d+)\. Breakdown: (.*)/);
                        if (match) {
                            try {
                                this.lastSyncStats = {
                                    faults: parseInt(match[1]),
                                    skipped: parseInt(match[2]),
                                    errors: parseInt(match[3]),
                                    breakdown: JSON.parse(match[4]),
                                    timestamp: summaryLog.timestamp
                                };
                            } catch (e) { console.error('Stats parsing error', e); }
                        }
                    }
                },
                async fetchDocs() {
                    const res = await fetch('/api/docs/list');
                    const data = await res.json();
                    this.docFiles = data.files || [];
                    if (this.docFiles.length && !this.currentDoc) {
                        this.loadDoc(this.docFiles[0]);
                    }
                },
                async loadDoc(file) {
                    this.loadingDoc = true;
                    this.currentDoc = file;
                    this.renderedDoc = '';
                    const res = await fetch(`/api/docs/content?file=${encodeURIComponent(file)}`);
                    const data = await res.json();
                    this.renderedDoc = marked.parse(data.content || '');
                    this.$nextTick(() => {
                        mermaid.init(undefined, document.querySelectorAll('.mermaid'));
                    });
                    this.loadingDoc = false;
                },
                toggleLog(log) {
                    const idx = log._index;
                    if (idx !== undefined && this.logs[idx]) {
                        this.logs[idx].expanded = !this.logs[idx].expanded;
                    }
                },
                async saveConfig() {
                    const res = await fetch('/api/config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.config)
                    });
                    alert(res.ok ? 'Saved!' : 'Error saving');
                },
                addRule(set) {
                    this.config.syncRules.ruleSets[set].rules.push({
                        tag: "", condition: "gt", value: 0, alarmType: "WARNING",
                        description: "New Rule", enabled: true
                    });
                },
                removeRule(set, index) {
                    this.config.syncRules.ruleSets[set].rules.splice(index, 1);
                },
                addMasterRule() {
                    this.config.syncRules.masterRules.push({
                        tag: "", value: 0, table: "", description: "New Master Rule",
                        condition: 'equals', alarmType: 'CRITICAL', complaintType: '', enabled: true,
                        priority: 1
                    });
                },
                removeMasterRule(index) {
                    this.config.syncRules.masterRules.splice(index, 1);
                },
                getPrerequisite(rule) {
                    if (!rule.prerequisite)
                        rule.prerequisite = { tag: '', condition: 'equals', value: '' };
                    return rule.prerequisite;
                },
                getDuration(rule) {
                    if (rule.duration && typeof rule.duration === 'string') {
                        rule.duration = { value: rule.duration, mode: 'continuous' };
                    }
                    return rule.duration || { value: '', mode: 'continuous' };
                },
                addDuration(rule) {
                    rule.duration = { value: '30m', mode: 'continuous' };
                },
                removeDuration(rule) {
                    delete rule.duration;
                }
            }
        }).mount('#app');
        // Initialize Mermaid before Vue
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default'
        });
    </script>
</body>

</html>